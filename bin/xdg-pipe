#!/bin/sh -e
##:
#h: Usage: xdg-pipe [-s SUFFIX][-p PROGRAM] < FILE
#h:
#h: Read from the standard input to a temporary file, and
#h: then open with `xdg-open(1)` or another program.
#x:
#x: Dependencies: xdg-pipe, xdg-open
##:
xdg_pipe() {
    local OPTIND optopt suffix= tmpfile= program=
    while getopts "s:p:" optopt; do
        case $optopt in
            s)  case "${OPTARG}" in
                    .*) suffix="${OPTARG}"  ;;
                    *)  suffix=".${OPTARG}" ;;
                esac
                ;;
            p)  program="${OPTARG}"
                ;;
            \?) return 1
                ;;
        esac
    done
    shift $(( $OPTIND - 1 ))
    tmpfile="`mktemp`"
    if test ! -n "${tmpfile}"; then
        return 1
    fi
    if test -n "${suffix}"; then
        mv "${tmpfile}" "${tmpfile}${suffix}"
        tmpfile="${tmpfile}${suffix}"
    fi
    cat > "${tmpfile}"
    if test -n "${program}"; then
        "${program}" "${tmpfile}"
    else
        xdg-open "${tmpfile}"
    fi
}
## -------------------------------------------------------------------
if test @"$(basename "$0")" = @"xdg-pipe";then
    case "${1}" in
        -h|--help) sed -n 's/^ *#h: \{0,1\}//p' "$0" ;;
        *)         xdg_pipe "$@"; exit 0;;
    esac
fi
