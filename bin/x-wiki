#!/bin/sh -e
##:
#h: Usage: x-wiki [-V] : Open/create notes.
#h:
#h: Environment variables: X_WIKI_DIRECTORY
#x: Dependencies: dmenu, xmessage, x-editor
##:
. dmenu-fsel
. x-editor
x_wiki() (
    local OPTIND optopt
    
    ## Parse command line options.
    while getopts "V" optopt; do
        case $optopt in
            V)  x_wiki_show_variables; return 0;;
            \?) return 1;;
        esac
    done
    shift $(( $OPTIND - 1 ))

    
    dmenu_fsel -n 'x-wiki:' -C "${X_WIKI_DIRECTORY}" -c 'new' | while read cmd loc; do
        case "${cmd}" in
            file)
                set +e
                xmessage -nearmouse -buttons quit:10,edit:11 -default quit -file "${loc}"
                ret="$?"
                set -e
                case "${ret}" in
                    10) true;;
                    11) x_editor "${loc}";;
                esac
                ;;
            new)
                x_editor -a "${loc}"
                ;;
        esac
    done
)
x_wiki_show_variables() {
    echo "X_WIKI_DIRECTORY : ${X_WIKI_DIRECTORY}"
}
x_wiki_calc_variables() {
    X_WIKI_DIRECTORY="${X_WIKI_DIRECTORY:-${HOME}/Documents/wiki}"
}
## -------------------------------------------------------------------
x_wiki_calc_variables
if test @"$(basename "$0")" = @"x-wiki";then
    case "${1}" in
        -h|--help) sed -n 's/^ *#h: \{0,1\}//p' "$0" ;;
        *)         x_wiki "$@"; exit 0;;
    esac
fi
