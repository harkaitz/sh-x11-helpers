#!/bin/sh -e
##:
#h: Usage: x-postit [-V][NOTE]
#x:
#x: Dependencies: dmenu, x-editor
##:
. dmenu-fsel
. x-editor
x_postit() {
    local OPTIND optopt= ops=
    
    ## Parse command line arguments.
    while getopts "V" optopt; do
        case $optopt in
            V)  echo "X_POSTIT_DIRECTORY : ${X_POSTIT_DIRECTORY}"; return 0;;
            \?) return 1;;
        esac
    done
    shift $(( $OPTIND - 1 ))
    
    ##
    if test -n "${1}"; then
        x_editor "${X_POSTIT_DIRECTORY}/${1}"
        return 0
    fi

    
    dmenu_fsel -n 'x-postit:' -C "${X_POSTIT_DIRECTORY}" -c 'new' | while read cmd loc; do
        case "${cmd}" in
            file) x_editor "${loc}";;
            new)  x_editor "${loc}";;
        esac
    done
}
## -------------------------------------------------------------------
X_POSTIT_DIRECTORY="${X_POSTIT_DIRECTORY:-${HOME}/Documents/postit}"
if test @"$(basename "$0")" = @"x-postit";then
    case "${1}" in
        -h|--help) sed -n 's/^ *#h: \{0,1\}//p' "$0";;
        *)         x_postit "$@"; exit 0;;
    esac
fi
