#!/bin/sh -e
##:
#h: Usage: x-auto -V
#h:
#h: Define scripts in "/etc/x-auto" with X11 automatizations with
#h: xdotool(1) and launch them with "x-auto".
##:
x_auto() {
    local OPTIND optopt n op=
    ## Parse command line arguments.
    while getopts "Vi" optopt; do
        case $optopt in
            V)  echo "X_AUTO_DIRECTORY : ${X_AUTO_DIRECTORY}"; return 0;;
            i)  true;;
            \?) return 1;;
        esac
    done
    shift $(( $OPTIND - 1 ))
    ## Operations.
    n="$(x_auto_list | dmenu -p 'x-auto:' -l 10 | sed 's| *:.*||')"
    test -n "${n}"
    sh -e "${X_AUTO_DIRECTORY}/${n}"
}
## -------------------------------------------------------------------
x_auto_list() {
    local f n h
    for f in $(find "${X_AUTO_DIRECTORY}" -type f); do
        n="$(basename "${f}")"
        h="$(sed -n 's|^\#help: *||p' "${f}")"
        printf '%-15s : %s\n' "${n}" "${h}"
    done
}
## -------------------------------------------------------------------
X_AUTO_DIRECTORY="${X_AUTO_DIRECTORY:-${H}/etc/x-auto}"
if test @"$(basename "$0")" = @"x-auto";then
    case "${1}" in
        -h|--help) sed -n 's/^ *#h: \{0,1\}//p' "$0";;
        *)         x_auto "$@"; exit 0;;
    esac
fi
